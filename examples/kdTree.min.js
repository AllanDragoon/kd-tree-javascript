function kdTree(n,k,f){function l(a,c){this.obj=a;this.right=this.left=null;this.dimension=c}function h(a,c){var b=c%f.length;if(0==a.length)return null;if(1==a.length)return new l(a[0],b);a.sort(function(a,c){return a[f[b]]-c[f[b]]});var g=Math.floor(a.length/2),e=new l(a[g],b);e.left=h(a.slice(0,g),c+1);e.right=h(a.slice(g+1),c+1);return e}function m(a){this.content=[];this.scoreFunction=a}var o=h(n,0);this.nearest=function(a,c,b){function g(d){var b;b=f[d.dimension];for(var e=k(a,d.obj),j={},i=
0;i<f.length;i++)j[f[i]]=i==d.dimension?a[f[i]]:d.obj[f[i]];j=k(j,d.obj);if(null==d.right&&null==d.left){if(bestNodes.size()<c||e<bestNodes.peek()[1])bestNodes.push([d,e]),bestNodes.size()>c&&bestNodes.pop()}else{b=null==d.right?d.left:null==d.left?d.right:a[b]<d.obj[b]?d.left:d.right;g(b);if(bestNodes.size()<c||e<bestNodes.peek()[1])bestNodes.push([d,e]),bestNodes.size()>c&&bestNodes.pop();if(bestNodes.size()<c||Math.abs(j)<bestNodes.peek()[1])d=b==d.left?d.right:d.left,null!=d&&g(d)}}bestNodes=
new m(function(a){return-a[1]});if(b)for(var e=0;e<c;e++)bestNodes.push([null,b]);g(o);b=[];for(e=0;e<c;e++)bestNodes.content[e][0]&&b.push([bestNodes.content[e][0].obj,bestNodes.content[e][1]]);return b};m.prototype={push:function(a){this.content.push(a);this.bubbleUp(this.content.length-1)},pop:function(){var a=this.content[0],c=this.content.pop();0<this.content.length&&(this.content[0]=c,this.sinkDown(0));return a},peek:function(){return this.content[0]},remove:function(a){for(var c=this.content.length,
b=0;b<c;b++)if(this.content[b]==a){var g=this.content.pop();b!=c-1&&(this.content[b]=g,this.scoreFunction(g)<this.scoreFunction(a)?this.bubbleUp(b):this.sinkDown(b));return}throw Error("Node not found.");},size:function(){return this.content.length},bubbleUp:function(a){for(var c=this.content[a];0<a;){var b=Math.floor((a+1)/2)-1,g=this.content[b];if(this.scoreFunction(c)<this.scoreFunction(g))this.content[b]=c,this.content[a]=g,a=b;else break}},sinkDown:function(a){for(var c=this.content.length,b=
this.content[a],g=this.scoreFunction(b);;){var e=2*(a+1),d=e-1,f=null;if(d<c){var h=this.scoreFunction(this.content[d]);h<g&&(f=d)}if(e<c&&this.scoreFunction(this.content[e])<(null==f?g:h))f=e;if(null!=f)this.content[a]=this.content[f],this.content[f]=b,a=f;else break}}}};
